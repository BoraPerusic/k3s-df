# CloudPirates / Official Image Configuration

# 1. Replica Count
replicaCount: 1

# 2. Ingress (Expose UI)
ingress:
  enabled: true
  className: traefik
  annotations:
    traefik.ingress.kubernetes.io/router.entrypoints: web
  rules:
    - host: keycloak.localhost
      paths:
        - path: /
          pathType: Prefix

# 3. Environment Variables (The Universal Config)
# Instead of relying on chart-specific parameters, we set standard Keycloak Env Vars.
extraEnv:
  # --- Admin Credentials ---
  - name: KEYCLOAK_ADMIN
    valueFrom:
      secretKeyRef:
        name: keycloak-admin-creds
        key: admin-user # Matches your sealed secret
  - name: KEYCLOAK_ADMIN_PASSWORD
    valueFrom:
      secretKeyRef:
        name: keycloak-admin-creds
        key: admin-password # Matches your sealed secret

  # --- Database Connection ---
  - name: KC_DB
    value: postgres
  - name: KC_DB_URL
    # Connect to the bundled postgres service
    value: "jdbc:postgresql://identity-keycloak-postgresql.identity.svc.cluster.local:5432/keycloak"
  - name: KC_DB_USERNAME
    value: keycloak
  - name: KC_DB_PASSWORD
    valueFrom:
      secretKeyRef:
        name: keycloak-db-creds
        key: password # Matches your sealed secret

  # --- Operational Settings ---
  - name: KC_HOSTNAME
    value: keycloak.localhost
  - name: KC_PROXY
    value: edge # We are behind Traefik (Edge TLS termination)
  - name: KC_METRICS_ENABLED
    value: "true"
  - name: KC_HEALTH_ENABLED
    value: "true"